<div class="profile_box span9">

  <legend>分享视播</legend>
  
  <%= render :partial => "upload/form" %>

  <%= form_for @cast, :html => { :id => "cast_share_form", :class => "simple_form form-horizontal" } do |f| %>
    <fieldset>

      <%= f.hidden_field :url %>

      <div class="control-group">
        <%= f.label :title, "标题", :class => "control-label" %>
        <div class="controls">
          <%= f.text_field :title, :class => "text_field" %>
          <p style="color:red"><%= @cast.errors[:title][0].to_s %></p>
        </div>
      </div>

      <div class="control-group">
        <%= f.label :price, "价格", :class => "control-label" %>
        <div class="controls">
          <%= f.select :price, options_for_select({"免费" => 0 , "1￥" => 1, "5￥" => 5, "10￥" => 10}, 1) %>
        </div>
      </div>


      <div class="control-group">
        <%= f.label :free_time, "试看时间", :class => "control-label" %>
        <div class="controls">
          <%= f.text_field :free_time, :value => "10", :class => "text_field" %>
          <p style="color:red"><%= @cast.errors[:free_time][0].to_s %></p>
        </div>
      </div>


      <div class="form-actions">
        <%= f.submit '上传', :id => "cast_share_btn", :class => 'btn btn-primary' %>
        <%= link_to '取消', casts_path, :class => 'btn' %>
      </div>

    </fieldset>
  <% end %>
</div>


<!-- The template to display files available for upload -->
<script id="template-upload" type="text/x-tmpl">
  <div class="upload">
    {%=o.name%}
    <div class="progress progress-striped ">
      <div class="bar" style="width: 0%"></div>
    </div>
  </div>
</script>

<script id="template-download" type="text/x-tmpl">
  <div class="upload">
    {%=o.name%}
    <div class="progress progress-striped ">
      <div class="bar" style="width: 0%"></div>
    </div>
  </div>
</script>

<script type="text/javascript" charset="utf-8">
  $(function () {
      // Initialize the jQuery File Upload widget:

      $('#videoupload').fileupload({
        dataType: "json",
        add: function(e,t){
          var n,r;
          return r=/(\.|\/)(mp4)$/i,n=t.files[0],r.test(n.type)||r.test(n.name)?(t.context=$(tmpl("template-upload",n)),$("#fileupload-area").html(t.context),t.submit()):alert("只支持mp4格式")
        },
        progress: function(e,t){
          var progress = parseInt(t.loaded / t.total * 100, 10);
          $('.progress .bar').css('width',progress + '%');
        },
        done: function(e,t){
          $('.progress .bar').css('width',100 + '%');
          $("#cast_url").val(t.result["key"]);
        }
    });
  });
</script>
