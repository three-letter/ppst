<% content_for :title do %>
分享视播
<% end %>

<% content_for :head do %>
  <meta name="url-token" content="<%= @cast.url %>"/>
<% end %>


<div class="span11">
<ul class="breadcrumb">
  <li><a href="<%= root_path %>">Home</a><span class="divider">/</span></li>
  <li class="active">Cast Show</li>
</ul>
</div>


<div class="profile_box span9">

  <div class="player">
    <%= render "player" %>
    
    <div class="row cast_show">
      <div class="cast_user">
        <img src="<%= @cast.user.avatar_type(:small) %>" style="border-radius: 50% 50% 50% 50%" />
      </div>
      <div class="cast_info">
        <div class="cast_title">
          <%= @cast.title %>
        </div>
        <div class="cast_time">
          <% unless @cast.tag_names.blank? %>
            <icon class="icon-tags"></icon>
            <%= @cast.tag_names %>
          <% end %>
          <blockquote class="pull-right">
            <small><%= @cast.user.name %>于<%= time_ago_in_words(@cast.created_at) %>前分享</small>
          </blockquote>
        </div>
       </div>
    </div>
    <hr>
    <%= render partial: "comments", locals: { comments: @cast.comments } %>
  </div>

  <a href="#play-pay" id="play-a" role="button" class="btn" data-toggle="modal" style="display:none">Pay</a>
  <div id="play-pay" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      免费试看
    </div>
    <div class="modal-body">
      <p>亲~ 该视频只能试看<%= @cast.free_time %>分钟 ，若需完整观看，请付费！</p>
    </div>
    <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true">Cancle</button>
      <button class="btn btn-primary">Go To Pay</button>
    </div>
  </div>

</div>

<script type="text/javascript">
  $("#jquery_jplayer_1").bind($.jPlayer.event.timeupdate, function(event){
    var free_time = <%= @cast.free_time %>;
    var current_time = event.jPlayer.status.currentTime;
    if(current_time > free_time * 60){
      $(this).jPlayer("pause", 0);
      $("#play-a").click();
    }
  }); 
</script>
